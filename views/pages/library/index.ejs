<div class="container my-4" x-data="responsivePage()">
  <nav class="mb-4 d-flex">
    <%- include('../../partials/breadcrumb') %>

    <a
      x-on:click.once="navigate('/library/add/folder?path=/<%= props.path.join('/') %>')"
      type="button"
      class="ms-auto btn btn-sm btn-primary"
    >
      Add folder
    </a>
  </nav>

  <div
    class="row g-3 mb-4"
    x-data="folderGrid('<%= props.csrf %>', '<%= props.path.join('/') %>')"
    x-on:dragend.prevent="dragging = false"
    x-on:drop="dragging = false"
    x-on:drop.prevent="handleMove"
  >
    <% if(props.path[0] !== '') { %>
    <div class="col-12 mb-3" x-show="dragging">
      <div
        class="col-3 p-2 border rounded"
        x-bind:class="{'border-2 border-primary': isOver('<%= props.parent.id %>')}"
        x-on:dragover.prevent="current_over = '<%= props.parent.id %>'"
        x-on:dragleave.prevent="current_over = null"
      >
        Move up
      </div>
    </div>

    <% } %> <% for (folder of props.folders) { %>

    <div class="col-12 col-md-6 col-lg-4 col-xl-3">
      <div
        class="card"
        draggable="true"
        style="cursor: move"
        x-bind:class="{'border-2 border-primary': isOver('<%= folder.id %>')}"
        x-on:dragover.prevent="current_over = '<%= folder.id %>'"
        x-on:dragstart.self="current = '<%= folder.id %>'; current_name = '<%= folder.name %>'; dragging = true"
        x-on:dragleave.prevent="current_over = null"
      >
        <div class="card-body">
          <h5 class="card-title mb-3">
            <i class="bi bi-folder"></i>
            <%= folder.name %>
          </h5>

          <div class="d-flex justify-content-between">
            <a
              x-on:click.once="navigate('/library/modify/folder?type=folder&id=<%= folder.id %>')"
              class="btn btn-sm btn-outline-dark"
            >
              Modify
            </a>

            <a
              x-on:click="navigate('/library?path=<%= folder.path %>')"
              class="btn btn-sm btn-primary"
            >
              Open
            </a>
          </div>
        </div>
      </div>
    </div>

    <% } %>
  </div>

  <div class="row g-3">
    <% for (image of props.images) { %>

    <div
      class="col-12 col-md-6 col-lg-4 col-xl-3"
      x-ref="image-<%= image.id %>"
      draggable="true"
    >
      <div class="card">
        <img
          src="/uploads/images/<%= image.src %>#<%= image.modified_at %>"
          alt="uploaded image"
          class="card-img-top"
          style="max-height: 16rem; object-fit: cover"
        />

        <div class="card-body">
          <h5 class="card-title mb-3">
            <i class="bi bi-image"></i>

            <%= image.name %>
          </h5>

          <div class="d-flex justify-content-between">
            <a
              href="/library/modify?type=image&id=<%= image.id %>"
              class="btn btn-sm btn-outline-dark"
              >Modify</a
            >

            <!-- x-on:click="deleteImage(<%= image.id %>)" -->
            <button class="btn btn-sm btn-outline-danger">Delete</button>
          </div>
        </div>
      </div>
    </div>

    <% } %>
  </div>
</div>
